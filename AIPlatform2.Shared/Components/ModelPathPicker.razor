@using AIPlatform2.Shared.Services
@inject SettingsService SettingsService
@inject IFolderPickerService FolderPickerService

<FluentStack Orientation="Orientation.Vertical" VerticalGap="10">


        <FluentTextField Value="@_displayPath"
                         Placeholder="Select model folder..."
                     ReadOnly="true" Label="Your Main Model Folder" style="width: 100%;" />
                     



            
    <FluentLabel Style="margin-bottom: 0px">@_validationError</FluentLabel>
    <FluentButton Appearance="Appearance.Accent" @onclick="OnBrowseClicked">Browse</FluentButton>

</FluentStack>

@code {
    private string? _displayPath = null;
    private string? _validationError;
  

    protected override void OnInitialized()
    {
        // Load saved path
        _displayPath = SettingsService.GetModelRootPath();
       
    }

    private async Task OnBrowseClicked()
    {
        _validationError = null;
       
        try
        {
            if (FolderPickerService is null)
            {
                _validationError = "The Tools To Open The Folder Picker Dialog Is Not Available For This Platform.";
                StateHasChanged();
                return;
            }

            // Ask platform to pick a folder
            var picked = await FolderPickerService.PickFolderAsync();

            if (string.IsNullOrWhiteSpace(picked))
            {
                _validationError = "Nothing Was Changed.";
                StateHasChanged();
                return;
            }

            if (!Directory.Exists(picked))
            {
                _validationError = "Picked Folder Does Not Exist.";
                StateHasChanged();
                return;
            }

            // show and auto-save — remove the next line if you prefer display-only
            SettingsService.SetModelRootPath(picked);
            _displayPath = SettingsService.GetModelRootPath();
            _validationError = "The New Path Was Successfully Saved."; 
            StateHasChanged();
        }
        catch (Exception ex)
        {
            _validationError = $"Error Opening Folder Picker: {ex.GetType().Name}: {ex.Message}";
            StateHasChanged();
        }
    }
}
